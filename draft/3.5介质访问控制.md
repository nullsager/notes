#计算机网络 #数据链路层

介质访问控制（MAC，Medium Access Control）：解决信道使用权的分配问题

> [!NOTE]
> 介质访问控制作用于局域网！

介质访问控制可分类为：
+ **静态划分信道**：信道划分介质访问控制
+ **动态媒体接入控制**，又可分为：
	+ 随机访问介质访问控制
	+ 轮询访问介质访问控制

> [!important]
> 只有使用**广播信道**的数据链路层，才需要考虑介质访问控制
> 
> 如果是使用点对点全双工的数据链路层，则不需要考虑介质访问控制

## 信道划分介质访问控制

信道划分介质访问控制通过**多路复用**技术实现，多路复用技术包括：
+ 频分复用（FDM）
+ 时分复用（TDM）
+ 波分复用（WDM）：对光信号的频分复用，此技术运用在光纤中。
+ 码分复用（CDM）

时分复用：

将全部的传输时间分为一个个等长的时间片段，称为 **TDM 帧**，再将每一个 TDM 帧划分出等长的时隙，每台主机在每一个 TDM 帧上占用固定序号的时隙。

统计时分复用（STDM，Static TDM），又称异步时分复用，它解决了一般时分复用信道利用率不高的问题。

> [!Info]
> 当某个主机被分配到时间片时正好没有数据需要传输，那就只能让传输信道空闲，这样就导致复用后信道利用率不高。


> [!Important]
> STDM 通过**集中器**实现，发送方的各个主机的数据被存储到集中器的**输入缓存**中，集中器按序扫描缓存，将缓存中的数据填入 STDM 帧中，当一个帧的数据填满之后，就将此帧发送出去。
> 
> 为缩短 STDM 帧的填满时间以尽快发出 STDM 帧，STDM 帧所容纳的时隙数往往小于主机的数量。

---
码分复用（CDM），也叫**码分多址（CDMA）**，C 是 code 的意思

每台主机使用一个特殊的**码型**，相互不干扰。


> [!Important]
> 所有主机可在同一时间内使用同样的频带进行通信

每一个比特时间被划分为 m 个短的间隔，称为**码片**（chip），给每台主机分配一个唯一的 m bits 码片序列。主机要发送 1，就发送码片，要发送 0，就发送码片对应的反码。

在主机发送数据时，以自身码片序列代表比特 1，以其二进制反码代表比特 0。

> [!Important]
> 每个主机的码片是相互正交的。
> 
> 码片序列自己与自己的规格化内积为 1，自己与自己反码规格化内积为-1

---
##  随机访问介质访问控制

> [!NOTE]
> 在使用随机访问协议的总线型网络中，主机可以随意发送信息，如果有两台或更多的主机在同一时刻发送信息，会发生碰撞导致所有主机都发送失败。
> 
> 为解决这个问题，需要让每个发送失败的主机都以一定的规则重传。

### ALOHA 协议

**想发就发，随机重发。**

时隙 ALOHA 协议：将所有主机的时间同步，将时间划分为等长的时隙。要求：
+ 主机只有在每个时隙开始的时刻才能发送帧
+ 发送一帧的时间必须小于等于时隙的长度

### CSMA 协议

（载波侦听多路访问，Carrier Sense Multiple Access），主机发送数据的策略有如下三种：

+ 1-坚持 CSMA：信道空闲立即发送数据，信道忙，继续侦听信道直到空闲，再发送数据。
+ 非加持 CSMA：信道空闲立即发送数据，信道忙，随机等待一个时间段后，再开始侦听。
+ p-坚持 CSMA（**只适用于分时隙的信道**）：信道空闲，有 p 的概率立即发送数据，1-p 的概率推迟到下一个时隙重新**侦听**。信道忙，推迟到下一个时隙重新**侦听**。

### CSMA/CD 协议

（载波监听多路访问/碰撞检测）


> [!NOTE]
> 碰撞检测：适配器边发送数据边检测信道上电压的变化情况，如果有多个主机同时发送数据，总线上的信号电压变化幅度会变大，主机通过总线电压变化幅度来检测冲突


> [!NOTE]
> CSMA/CD 协议用于总线型网络和半双工网络这类可能发生冲突的网络，在全双工网络这类不会发生冲突的网络中不需要。

执行流程：发前先听，边发边听，冲突停发，随机重发。

> [!attention] 
> 如果检测到碰撞会发送一个拥塞信号，让该信道上所有主机都知道


> [!Important]
> $最小帧长=争用期\times 传输速率$
> 
> 如果数据帧太小，使得在碰撞之前侦听就已经停止，那么就无法检测到碰撞，而误以为数据包已经成功发送。

$$
\frac{最短帧长}{线路带宽}=2\times \frac{最远两台主机的距离}{线路中数据的传播速度}
$$
截断二进制指数退避算法：

+ 当前已经重传次数为 $n$，令 $k=min(n+1,10)$ （k 可以理解为碰撞次数）
+  $r$ 为整数集合 $\{0,1,\dots,2^k-1\}$ 中任意一个数
+ 推迟时间 $t=2\tau \times r$
+ 重传次数最大为 16 次

### CSMA/CA 协议（载波监听多路访问/碰撞避免）


> [!NOTE] 
> CSMA/CA 协议在无线信道中使用

无线信道无法实现碰撞检测的原因：

+ 无线信道信号衰减速度快，若想实现碰撞检测对硬件的要求过高。
+ 存在隐蔽站问题
+ 存在暴露站问题


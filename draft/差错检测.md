#计算机网络  #数据链路层

误码率（Bit Error Rate，BER）：一段时间内，传输的错误比特数量占总比特数量。

> [!question] 如何降低误码率
> 提高链路信噪比

码距：两个长度相同的编码之间：对应二进制位不同的数量，也成为海明距离。

编码集的码距：编码集中任意两个编码码距的**最小值**


> [!Attention] 
> 码距为 1 的编码集不具备检测误码的能力，不能作为校验码编码集

编码集的码距决定了其是否能够作为校验码以及作为校验码时的检错/纠错能力。

增大编码集的码距（通过给编码集中每个编码增加冗余数据），可以把原本不具备检错能力的编码集变成具有纠错能力的编码集。

校验码编码集的码距与校验码的检错和纠错能力关系：

| 码距 $d$，检错 $e$，纠错 $t$ 的关系 | 检错能力，纠错能力              |
| ------------------------ | ---------------------- |
| $d\ge e+1$               | 可检测 $e$ 个误码            |
| $d\ge 2t+1$              | 可纠正 $t$ 个误码            |
| $d\ge e+t+1$ 且 $e\ge t$  | 可检测 $e$ 个误码并纠正 $t$ 个误码 |

下面介绍能够纠正 1 位误码的海明校验码（码距为 3）：

将 $r$ 位校验位按规则插入 $m$ 位原始数据中（海明校验码有 $m+r$ 位）


> [!tips] 
> $r$ 位校验位共有 $2^r$ 个组合：
> 
> + 全 0 代表未出现误码
> + 其他组合用来指出误码位置

则有：
$$
m+r\le 2^r-1
$$
其中 $m+r$ 代表**需要定位的错误总数**，$2^r-1$ 代表**校验位能提供的有效纠错信号总数**。


> [!NOTE] 
> 这个公式可以推出：原始数据的位数 m 每增大 1 倍，所需的校验位数 r 只增加 1 位。
> 
> 原始数据的位数 m 越大，编码效率越高。

$r$ 位校验位应该依次放在海明校验码中编号为 2 的幂次方位，从 $2^0$ 到 $2^{r-1}$ 位，剩余的位就是数据位。

每个校验位对应一个校验组，每个数据位对应两个或两个以上的校验组。

![](78dba29fea6abce4835787bf0bac4c2c.jpg)

+ 校验位 $P_{1}$ 对应的校验组：从 $P_{1}$ 所在海明校验码中的位置编号 1 开始，选中 1 个，跳过 1 个，一直重复。
+ 校验位 $P_{2}$ 对应的校验组：从 $P_{2}$ 所在海明校验码中的位置编号 2 开始，选中 2 个，跳过 2 个，一直重复。
+ 校验位 $P_{3}$ 对应的校验组：从 $P_{3}$ 所在海明校验码中的位置编号 4 开始，选中 4 个，跳过 4 个，一直重复。
+ 校验位 $P_{4}$ 对应的校验组：从 $P_{4}$ 所在海明校验码中的位置编号 8 开始，选中 8 个，跳过 8 个，一直重复。

**$P_{i}$ 为对应校验组异或和。**

> [!NOTE] 
> 这说明海明校验是偶校验

![](2dc465e1a4173354e84719f8013abcaf.jpg)
校验结果 $G_{4}G{3}G{2}G{1}$ 的值为 0 表明没有误码。

---

IPv 4 分组首部的校验方法（只针对 IPv 4 的首部，不保护数据部分）：

发送方的计算过程：

在发送数据包之前，发送方会执行以下步骤来计算校验和：

1. 清零校验和字段：将 IPv 4 首部中的“首部校验和”字段置为全 0
2. 分段求和：将整个 IPv 4 首部看作是一个由多个 16 位整数组成的序列，然后依次进行反码求和。

> [!NOTE] 反码求和：
> 如果加法结果产生了超过 16 位的进位（即第 17 位为 1），则需要将这个进位加回到结果的最低位上。

3. 取反码：将最终得到的累加和按位取反，得到的结果就是最终的校验和。
4. 填入首部：将计算出的校验和填入 IPv 4 首部的“首部校验和”字段中，然后将数据包发送出去。

接收方的验证过程：

1. 提取首部并分段：将收到的 IPv 4 首部同样按 16 位分段。
2. 进行反码求和：使用与发送方完全相同的方法，对所有 16 位分段进行反码求和。
3. 检查结果：如果最终的累加和是**全 1**（即 16 位的 1111 1111 1111 1111，十六进制为 0 xFFFF），则证明首部在传输过程中没有检测到错误，数据包可以继续被处理。如果结果不是全 1，则表明首部在传输中发生了错误。此时，接收方（通常是路由器）会丢弃这个数据包，并且通常不会发送任何错误通知。




